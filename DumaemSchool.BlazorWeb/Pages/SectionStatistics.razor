@page "/section-statistics/{id:int}"
@using DumaemSchool.Core.Queries.Statistics

@inject ISender Sender;

<MudContainer MaxWidth="MaxWidth.ExtraLarge" style="height:70vh; margin-top: 2%">
    <MudDataGrid T="SectionStudentStatistics" ServerData="GetData" Striped="true">
        <ToolBarContent>
            <MudText Typo="Typo.h6">Статистика</MudText>
        </ToolBarContent>
        <Columns>
            <PropertyColumn Filterable="true" Property="x => x.SectionName" SortBy="x => x.SectionName" Title="Наименование группы"/>
            <PropertyColumn Filterable="true" Property="x => x.StudentName" SortBy="x => x.StudentName" Title="ФИО ученика"/>
            <PropertyColumn Filterable="true" Property="x => x.FactVisitedLessonsCount" SortBy="x => x.FactVisitedLessonsCount" Title="Посещенное количество занятий"/>
            <PropertyColumn Filterable="true" Property="x => x.PlanVisitedLessonsCount" SortBy="x => x.PlanVisitedLessonsCount" Title="Плановое количество занятий"/>
            <PropertyColumn Filterable="true" Property="x => x.PositiveMarksCount" SortBy="x => x.PositiveMarksCount" Title="Количество положительных оценок"/>
            <PropertyColumn Filterable="true" Property="x => x.NegativeMarksCount" SortBy="x => x.NegativeMarksCount" Title="Количество отрицательных оценок"/>
        </Columns>
        <PagerContent>
            <MudDataGridPager InfoFormat="{first_item}-{last_item} из {all_items}" RowsPerPageString="Отображать строк:"></MudDataGridPager>
        </PagerContent>
    </MudDataGrid>
</MudContainer>

@code {
    [Parameter]
    public int Id { get; set; }
    
    private async Task<GridData<SectionStudentStatistics>> GetData(GridState<SectionStudentStatistics> state)
    {
        var filters = new List<FilterDefinition> {new() { FieldName = nameof(SectionInfo.TeacherId), Value = Id, Operand = FilterOperand.Equal }};
        var result = await Sender.Send(new SectionStudentsStatisticsQuery(Id));

        return new GridData<SectionStudentStatistics> { Items = result.Items, TotalItems = result.TotalItemsCount };
    }
}